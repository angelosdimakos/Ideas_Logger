# ───────────────────────────────────────────────────────────────
# Development Dockerfile - includes all tools (largest size)
# ───────────────────────────────────────────────────────────────
FROM python:3.11-slim-bookworm

# Install development packages and dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        git \
        ca-certificates \
        curl \
        procps \
        tk tcl \
        libx11-6 libxext6 libxrender1 libxtst6 \
        xvfb xauth \
        vim \
        less \
        libgomp1 && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Create non-root user
ARG USER_UID=1001
ARG USER_GID=1001
RUN groupadd -g "${USER_GID}" myuser && \
    useradd -u "${USER_UID}" -g myuser -m myuser

# Switch to non-root user
USER myuser
WORKDIR /app

# Create and use virtual environment
RUN python -m venv /home/myuser/.venv
ENV PATH="/home/myuser/.venv/bin:$PATH" \
    PYTHONPATH=/app \
    PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1

# Copy requirements files
COPY --chown=myuser:myuser requirements*.txt ./

# Install all requirements (including dev tools)
RUN pip install --no-cache-dir -r requirements-prod.txt -r requirements-dev.txt && \
    pip install --no-cache-dir ipython jupyter && \
    rm -rf ~/.cache/pip

# Create volume for code
VOLUME ["/app"]

# Default command for development container
CMD ["bash"]